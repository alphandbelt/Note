### 2020/12/17

#### install libguestfs 

* 在ubuntu中需要安装的依赖

sudo apt install erlang-guestfs gir1.2-guestfs-1.0 golang-guestfs-dev guestfsd libguestfs-dev libguestfs-gfs2 libguestfs-gobject-1.0-0 libguestfs-gobject-dev libguestfs-hfsplus libguestfs-java libguestfs-jfs libguestfs-nilfs libguestfs-ocaml libguestfs-ocaml-dev libguestfs-perl libguestfs-reiserfs libguestfs-rescue libguestfs-rsync libguestfs-nilfs libguestfs-ocaml libguestfs-ocaml-dev libguestfs-perl libguestfs-reiserfs libguestfs-rescue libguestfs-rsync libguestfs-tools libguestfs-xfs libguestfs-zfs libguestfs0 lua-guestfs php-guestfs python-guestfs python3-guestfs ruby-guestfs gperf flex bison po4a xz-utils libjansson-dev libhivex-dev libmagic-dev libconfig-dev libxml2-dev libagues-dev libhivex-ocaml libhivex-ocaml-dev

* 卸载之前安装的所有默认的openjdk

* 重新安装一个openjdk8

  > sudo apt-get install openjdk-8-jdk

* erlang 1.23

* ubuntu18 install erlang 1.23

  * wget -O- https://packages.erlang-solutions.com/ubuntu/erlang_solutions.asc | sudo apt-key add -

  * echo "deb https://packages.erlang-solutions.com/ubuntu bionic contrib" | sudo tee /etc/apt/sources.list.d/rabbitmq.list

  * sudo apt update && sudo apt install erlang

  * ```bash
    sudo update-alternatives --set java /usr/lib/jvm/java-1.8.0-openjdk-amd64/bin/java
    ```
  
* ubuntu java 没有javac 

  * sudo apt install default-jre 
  * sudo apt install default-jdk

### 2020/12/18

* 在redhat 版本 >= 7.2不支持挂载NTFS

### 2020/12/21

* centos install libmagic没有 ，使用yum install file-devel

### 2020/12/22

* centos在7.1中使用yum-builddep 会导致自动升级到centos7.9

### 2020/12/25

#### targetcli

* target 是目标端，在target 上进行要分享设备的设置
  * 启动服务
    * systemctl start target 
    * systemctl enable target （开启启动）
  * 添加一个设备
    * cd /backstores/fileio/
    * create disk0 /tmp/disk0.img 10MB
    * cd /backstores/ramdisk/
    * create rd0 10MB
  * 创建target
    * cd /iscsicd 
    * create   （创建完之后portal自动创建）
  * 设置 ACL
    * cd /iscsi/iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.46377ffefd36/tpg1/acls/
    * create iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.46377ffefd36
  * 设置TPG
    * 0.0.0.0：3260
  * 开启端口
    * firewall-cmd --add-port 3260/tcp --permanent && firewall-cmd 
  * 添加（添加的设备）到tpg
    * cd /iscsi/iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.46377ffefd36/tpg1/luns/
    * create /backstores/fileio/disk0
    * create /backstores/ramdisk/rd0
  * 保存配置
    * cd /
    * saveconfig

#### initiator

* initator是用户端，在这个上面发现target上分享的设备
  * 添加发现
    * iscsiadm -m discovery -t sendtargets -p 192.168.50.145:3260
  * 登录
    * iscsiadm --mode node --targetname iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.46377ffefd36 --portal 192.168.50.145 --login
  * lsblk 发现
    * ![image-20201225152751579](C:\Users\win10\AppData\Roaming\Typora\typora-user-images\image-20201225152751579.png)

### 2020/12/28

* LUNs(logical unit number)
* IQN(**iSCSI Qualified Name**)
* RDMA(Remote Direct Memory Access)

### 2021/01/13

* tmux 开启鼠标滚动
  * setw -g mode-mouse on

### 2021/2/3

1. 修改创建lun和lun映射的接口，之前创建lun需要输入序号，如果有多个的话方锐这边不知道要输入哪个，现在改为序号不需要输入，自动增长。

2. 解决显示vgpool时的size大小和lvs显示的不一致问题，由单位不一致引起，已解决。

   

### 2021/2/5

1. 修改删除mapped lun 

### 2021/2/7

创建lun的tpg时需要指定tag 1

### 2021/2/22

* 安装mariadb 到windows
  * 下载地址
    * https://mariadb.com/downloads/
  * 文档
    * https://mariadb.com/kb/en/installing-mariadb-msi-packages-on-windows/

### 2021/3/2

#### 任务计划

* 优先级队列， 调度任务的执行
* 保存task信息时，要通过MQ来进行（好像是已经完成了）
* 对更新字段的配置接口要修改，传值还是要通过post formvalue，来进行，不能通过json的方式，**直接写成一个接口**

### 2021/3/8

* 运行nats-streaming-server 
  * nats-streaming-server -store sql -sql_driver mysql -sql_source "nss:password@/nss_db?readTimeout=5s&writeTimeout=5s" 
* mysql 创建表
  * https://github.com/nats-io/nats-streaming-server/blob/master/scripts/mysql.db.sql
  * 运行命令
    * mysql -u nss -p -D nss_db -e "$(cat ./scripts/mysql.db.sql)"
* mysql 创建数据库
  * mysql -u root -e "CREATE USER 'nss'@'localhost' IDENTIFIED BY 'password'; GRANT ALL PRIVILEGES ON *.* TO 'nss'@'localhost'; CREATE DATABASE nss_db;"

### 2021/3/9

#### Nats Streaming 

* nats streaming的client和服务端交互的时候不直接交互，而是通过nats server来进行
* nats client和nats streaming客户端彼此之间消息不互通
* 如果服务端没有收到心跳包（配置的数量），服务端就会主动关闭连接

### 2021/3/10

* nats streaming的这个还可以使用Grafana 或者Prometheus的监控前端页面展示。

## 2021/7/6

* centos 卸载Mariadb安装 MySQL

* 下载rpm包 https://dev.mysql.com/downloads/repo/yum/ 

* 执行命令卸载Mariadb 

  * rpm -qa | grep Maria*
  * yum -y remove Maria*
  * rm -rf /var/lib/mysql

* 安装

  * 参考链接 https://dev.mysql.com/doc/refman/5.7/en/linux-installation-yum-repo.html
  * sudo yum localinstall mysql80-community-release-el7-3.noarch.rpm
  * 启动mysql服务
    * sudo service mysqld start
  * 查看服务
    * sudo service mysqld status
  * 查看默认密码
    * sudo grep 'temporary password' /var/log/mysqld.log
  * 登录并且修改密码
    * mysql -uroot -p
    * ALTER USER 'root'@'localhost' IDENTIFIED BY 'MyNewPass4!';

  ###  删除lv时出现被占用的情况

   * 执行脚本找出与该lvm相关的进程

      * ```shell
        for i in  /proc/[0-9]* ; do echo $i >> /tmp/mountinfo ;  grep -q "/dev/mapper/test-vg-test-storage" $i/mountinfo ; echo $? >> /tmp/mountinfo ; done
        ```

   * 查看

      * ```shell
        grep -B 1 '^0$' /tmp/mountinfo
        ```

## 2021/07/08

* mysql修改数据目录
  * 
  * https://blog.csdn.net/ruanhao1203/article/details/52242438

